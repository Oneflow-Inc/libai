name: Python checks

env:
  ONEFLOW_SRC: oneflow-src
on:
  pull_request:
    types: [review_requested]
    branches:
      - "*"
  workflow_dispatch:
    inputs:
      placeholder:
        description: "placeholder, no effect"
        required: false
jobs:
  linter:
    name: Run linter
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python 3.6
        uses: actions/setup-python@v2
        with:
          python-version: 3.6
      - name: Install dependencies
        # flake8-bugbear flake8-comprehensions are useful but not available internally
        run: |
          python -m pip install --upgrade pip
          python -m pip install flake8==3.8.1 isort==4.3.21 autoflake==1.4
          python -m pip install black==21.4b2
          flake8 --version
      - name: Lint
        id: py_check
        run: |
          echo "Running autoflake"
         	autoflake --ignore-init-module-imports --remove-all-unused-imports -r libai tests
          echo "Running isort"
	        isort --diff --check libai tests
          echo "Running flake8"
        	flake8 libai tests
      - name: Please request CI again
        if: ${{ failure() }}
        run: |
          exit 1
